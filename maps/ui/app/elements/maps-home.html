<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="maps-home">

  <template>

    <style>
      :host {
        display: block;
        padding: 10px;
      }
      .card {
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
        padding: 16px;
        margin: 24px;
        border-radius: 5px;
        background-color: #fff;
        color: #757575;
      }
      .circle {
        display: inline-block;
        height: 64px;
        width: 64px;
        border-radius: 50%;
        background: #ddd;
        line-height: 64px;
        font-size: 30px;
        color: #555;
        text-align: center;
      }
      h1 {
        font-size: 22px;
        margin: 16px 0;
        color: #212121;
      }
    </style>

    <iron-ajax id="userInfo"
      url="http://localhost:8080/_ah/api/userApi/v1/users"
      method="GET"
      headers="{{authorization}}"
      handle-as="json"
      on-response="handleResponse"
      ></iron-ajax>

    <div class="card">
      <p>ID: {{data.id}}</p>
      <p>User: {{data.email}}</p>
      <p>Active: {{data.active}}</p>
    </div>

  </template>

  <script>

    Polymer({
      is: 'maps-home',

      properties: {
        user: {
          type: Object,
          value: null,
          observer: 'userChanged'
        },

        authorization: {
          type: Object,
          computed: 'getToken(user)'
        }
      },

      getToken: function (user) {
        if(user) {
          var authR = user.getAuthResponse();
          return {
            Authorization: authR['token_type'] + ' ' + authR['access_token']
          };
        }
        return '';
      },

      userChanged: function () {
        if(this.$.userInfo) {
          this.$.userInfo.generateRequest();
        }
      },

      handleResponse: function (e, response) {
        var res = response.parseResponse();
        this.data = res.items[0];
      }
    });

  </script>

</dom-module>
